<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>My Tasks</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0"
        rel="stylesheet" />

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#6366f1", // Indigo-500
                        "primary-glow": "#818cf8",
                        "accent": "#10b981", // Emerald-500
                        "danger": "#f43f5e", // Rose-500
                        "dark-bg": "#0B0C15", // Deep Space Black
                        "glass-surface": "rgba(255, 255, 255, 0.03)",
                        "glass-border": "rgba(255, 255, 255, 0.08)",
                        "glass-highlight": "rgba(255, 255, 255, 0.1)",
                    },
                    fontFamily: {
                        "display": ["Outfit", "sans-serif"]
                    },
                    boxShadow: {
                        "neon": "0 0 20px rgba(99, 102, 241, 0.4)",
                        "glass": "0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06), inset 0 1px 0 rgba(255, 255, 255, 0.1)",
                        "glass-hover": "0 10px 15px -3px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2)"
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                        'mesh': "radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%)",
                    }
                },
            },
        }
    </script>
    <style>
        body {
            background-color: #0B0C15;
            color: #E2E8F0;
        }

        .glass-card {
            background: rgba(20, 21, 31, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .glass-input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: white;
        }

        .glass-input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="bg-dark-bg font-display min-h-screen selection:bg-primary/30 selection:text-white">
    <!-- Ambient Background Mesh -->
    <div class="fixed inset-0 z-0 opacity-40 bg-mesh pointer-events-none"></div>

    <div
        class="relative z-10 flex h-full min-h-screen w-full flex-col overflow-x-hidden max-w-md mx-auto border-x border-glass-border bg-dark-bg/50 backdrop-blur-sm">

        <!-- Header -->
        <div
            class="flex items-center justify-between p-6 pb-4 sticky top-0 z-20 bg-dark-bg/80 backdrop-blur-xl border-b border-glass-border">
            <div>
                <h1 class="text-white text-3xl font-bold tracking-tight">Tasks</h1>
                <p id="header-greeting" class="text-xs text-gray-400 font-medium uppercase tracking-widest mt-1">
                    Workspace</p>
            </div>
            <a href="profile.html" class="relative group">
                <div id="header-profile-pic"
                    class="user-profile-pic bg-center bg-no-repeat bg-cover rounded-2xl size-12 ring-2 ring-glass-border group-hover:ring-primary/50 transition-all shadow-lg"
                    style=''>
                    <div id="header-profile-placeholder"
                        class="w-full h-full flex items-center justify-center bg-[#1a1b26] text-gray-400 hidden">
                        <span class="material-symbols-rounded">person</span>
                    </div>
                </div>
                <div class="absolute -bottom-1 -right-1 size-4 bg-accent rounded-full border-2 border-dark-bg"></div>
            </a>
        </div>

        <!-- Search -->
        <div class="px-6 py-2">
            <div class="relative group">
                <span
                    class="material-symbols-rounded absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-primary transition-colors">search</span>
                <input id="search-input" type="text" placeholder="Search your mission..."
                    class="w-full glass-input rounded-2xl py-3.5 pl-12 pr-4 text-sm font-medium placeholder:text-gray-600 outline-none transition-all">
            </div>
        </div>

        <!-- Categories/Tabs -->
        <div class="flex gap-3 overflow-x-auto px-6 py-2 scrollbar-hide pb-4">
            <button data-filter="All"
                class="category-btn px-5 py-2.5 rounded-xl bg-primary text-white text-xs font-bold tracking-wide shadow-neon transition-all hover:scale-105 active:scale-95">ALL</button>
            <button data-filter="Personal"
                class="category-btn px-5 py-2.5 rounded-xl glass-card text-gray-400 hover:text-white hover:bg-white/5 text-xs font-bold tracking-wide transition-all border border-transparent hover:border-glass-border">PERSONAL</button>
            <button data-filter="Work"
                class="category-btn px-5 py-2.5 rounded-xl glass-card text-gray-400 hover:text-white hover:bg-white/5 text-xs font-bold tracking-wide transition-all border border-transparent hover:border-glass-border">WORK</button>
            <button data-filter="Urgent"
                class="category-btn px-5 py-2.5 rounded-xl glass-card text-gray-400 hover:text-white hover:bg-white/5 text-xs font-bold tracking-wide transition-all border border-transparent hover:border-glass-border">URGENT</button>
        </div>

        <!-- Task List -->
        <div id="task-list" class="flex flex-col flex-1 px-6 gap-4 pb-28">
            <!-- Tasks rendered via JS -->
        </div>

        <!-- Add Task Modal -->
        <div id="add-task-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
            <div class="absolute inset-0 bg-black/60 backdrop-blur-md opacity-0 transition-opacity modal-backdrop">
            </div>
            <div
                class="relative w-full max-w-sm glass-card bg-[#1a1b26]/90 rounded-3xl p-6 shadow-2xl border border-glass-highlight transform scale-95 opacity-0 transition-all modal-content">

                <div class="flex items-center justify-between mb-6">
                    <h2
                        class="text-2xl font-bold bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent">
                        New Mission</h2>
                    <button
                        class="modal-close size-8 flex items-center justify-center rounded-full hover:bg-white/10 transition-colors">
                        <span class="material-symbols-rounded text-gray-400">close</span>
                    </button>
                </div>

                <div class="space-y-4">
                    <div class="space-y-1.5">
                        <label class="text-[10px] font-bold uppercase tracking-widest text-primary">Objective</label>
                        <input id="new-task-title" type="text" placeholder="Enter task title..."
                            class="w-full bg-black/20 border border-glass-border rounded-xl px-4 py-3 text-white placeholder:text-gray-600 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-1.5">
                            <label
                                class="text-[10px] font-bold uppercase tracking-widest text-gray-500">Priority</label>
                            <div class="relative">
                                <select id="new-task-priority"
                                    class="w-full appearance-none bg-black/20 border border-glass-border rounded-xl px-4 py-3 text-sm text-white outline-none focus:border-primary">
                                    <option value="Low">Low</option>
                                    <option value="Medium">Medium</option>
                                    <option value="High">High</option>
                                </select>
                                <span
                                    class="material-symbols-rounded absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none text-sm">expand_more</span>
                            </div>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-[10px] font-bold uppercase tracking-widest text-gray-500">Sector</label>
                            <div class="relative">
                                <select id="new-task-category"
                                    class="w-full appearance-none bg-black/20 border border-glass-border rounded-xl px-4 py-3 text-sm text-white outline-none focus:border-primary">
                                    <option value="Personal">Personal</option>
                                    <option value="Work">Work</option>
                                    <option value="Urgent">Urgent</option>
                                </select>
                                <span
                                    class="material-symbols-rounded absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none text-sm">expand_more</span>
                            </div>
                        </div>
                    </div>

                    <div class="pt-4 flex gap-3">
                        <button
                            class="modal-close flex-1 py-3.5 rounded-xl border border-glass-border text-gray-300 font-bold hover:bg-white/5 transition-colors">Cancel</button>
                        <button id="save-task-btn"
                            class="flex-1 py-3.5 rounded-xl bg-primary text-white font-bold shadow-neon hover:bg-primary-glow transition-all">Create</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- FAB -->
        <button id="fab-add-task" class="fixed bottom-24 right-6 z-40 group">
            <div class="absolute inset-0 bg-primary/20 blur-xl rounded-full group-hover:blur-2xl transition-all"></div>
            <div
                class="relative flex items-center justify-center size-14 rounded-full bg-primary text-white shadow-neon group-hover:scale-110 group-active:scale-95 transition-all outline-none ring-2 ring-white/20">
                <span class="material-symbols-rounded text-3xl">add</span>
            </div>
        </button>

        <!-- Bottom Nav -->
        <div class="sticky bottom-0 z-30 w-full glass-card border-t border-glass-border backdrop-blur-xl">
            <div class="grid grid-cols-5 h-20 items-center">
                <button class="flex flex-col items-center justify-center gap-1.5 text-primary group">
                    <div class="relative">
                        <span
                            class="material-symbols-rounded text-2xl group-hover:-translate-y-0.5 transition-transform"
                            style="font-variation-settings: 'FILL' 1;">list</span>
                        <div class="absolute -bottom-2.5 left-1/2 -translate-x-1/2 w-1 h-1 bg-primary rounded-full">
                        </div>
                    </div>
                    <span class="text-[10px] font-bold tracking-wide">Tasks</span>
                </button>
                <a href="board.html"
                    class="flex flex-col items-center justify-center gap-1.5 text-gray-500 hover:text-white transition-colors group">
                    <span
                        class="material-symbols-rounded text-2xl group-hover:-translate-y-0.5 transition-transform">view_kanban</span>
                    <span class="text-[10px] font-bold tracking-wide">Board</span>
                </a>
                <a href="calendar.html"
                    class="flex flex-col items-center justify-center gap-1.5 text-gray-500 hover:text-white transition-colors group">
                    <span
                        class="material-symbols-rounded text-2xl group-hover:-translate-y-0.5 transition-transform">calendar_month</span>
                    <span class="text-[10px] font-bold tracking-wide">Cal</span>
                </a>
                <a href="alerts.html"
                    class="flex flex-col items-center justify-center gap-1.5 text-gray-500 hover:text-white transition-colors group">
                    <span
                        class="material-symbols-rounded text-2xl group-hover:-translate-y-0.5 transition-transform">notifications</span>
                    <span class="text-[10px] font-bold tracking-wide">Alerts</span>
                </a>
                <a href="settings.html"
                    class="flex flex-col items-center justify-center gap-1.5 text-gray-500 hover:text-white transition-colors group">
                    <span
                        class="material-symbols-rounded text-2xl group-hover:-translate-y-0.5 transition-transform">settings</span>
                    <span class="text-[10px] font-bold tracking-wide">Cfg</span>
                </a>
            </div>
        </div>
    </div>
    <script src="app.js"></script>
    <script>
        // Modal Logic
        const modal = document.getElementById('add-task-modal');
        const modalContent = modal.querySelector('.modal-content');
        const fab = document.getElementById('fab-add-task');
        const closeBtns = document.querySelectorAll('.modal-close');
        const saveBtn = document.getElementById('save-task-btn');
        const taskListContainer = document.getElementById('task-list');

        function openModal() {
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.querySelector('.modal-backdrop').classList.remove('opacity-0');
                modalContent.classList.remove('opacity-0', 'scale-95');
                modalContent.classList.add('opacity-100', 'scale-100');
            }, 10);
        }

        function closeModal() {
            modal.querySelector('.modal-backdrop').classList.add('opacity-0');
            modalContent.classList.remove('opacity-100', 'scale-100');
            modalContent.classList.add('opacity-0', 'scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        fab.addEventListener('click', openModal);
        closeBtns.forEach(btn => btn.addEventListener('click', closeModal));
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });

        // Use TaskManager logic
        function renderTasks() {
            const allTasks = TaskManager.getAll();
            const filter = currentCategory;
            const query = searchInput.value.toLowerCase();

            taskListContainer.innerHTML = '';

            // Pending Tasks
            const pendingTasks = allTasks.filter(t => t.status !== 'Completed');
            pendingTasks.forEach(task => {
                if (shouldShow(task, filter, query)) {
                    taskListContainer.appendChild(createTaskElement(task));
                }
            });

            // Completed Header
            const completedTasks = allTasks.filter(t => t.status === 'Completed');
            if (completedTasks.length > 0) {
                const header = document.createElement('div');
                header.className = "pt-6 flex items-center justify-between";
                header.innerHTML = `
                    <span class="text-white text-xs font-bold uppercase tracking-widest">Completed Missions</span>
                    <span class="px-2 py-0.5 rounded-md bg-white/10 text-gray-400 text-[10px] font-bold">${completedTasks.length}</span>
                 `;
                taskListContainer.appendChild(header);

                completedTasks.forEach(task => {
                    if (shouldShow(task, filter, query)) {
                        taskListContainer.appendChild(createTaskElement(task));
                    }
                });
            }
        }

        function shouldShow(task, filter, query) {
            const matchesFilter = filter === 'All' || task.category === filter;
            const matchesQuery = task.title.toLowerCase().includes(query);
            return matchesFilter && matchesQuery;
        }

        function createTaskElement(task) {
            const isCompleted = task.status === 'Completed';
            const div = document.createElement('div');

            // Colors
            let statusColor = 'text-gray-400';
            if (task.status === 'In Progress') statusColor = 'text-primary';
            else if (task.status === 'In Review') statusColor = 'text-purple-400';
            else if (task.status === 'Accepted') statusColor = 'text-accent';
            else if (task.status === 'Rejected') statusColor = 'text-danger';

            const checkboxClass = isCompleted
                ? 'bg-accent border-accent text-dark-bg'
                : 'border-gray-500 hover:border-primary transition-colors';

            const titleClass = isCompleted
                ? 'text-gray-500 line-through'
                : 'text-gray-100 font-medium group-hover:text-white transition-colors';

            div.className = "group relative p-4 rounded-2xl glass-card hover:shadow-glass-hover transition-all cursor-pointer border-transparent hover:border-glass-highlight";
            if (isCompleted) div.classList.add('opacity-60');

            div.innerHTML = `
                <div class="flex items-start gap-4">
                    <div class="task-checkbox mt-1 flex items-center justify-center size-5 shrink-0 rounded-full border-2 ${checkboxClass} z-10 transition-all cursor-pointer">
                        ${isCompleted ? '<span class="material-symbols-rounded text-sm font-bold">check</span>' : ''}
                    </div>
                    <div class="flex flex-col flex-1 gap-1 min-w-0">
                        <h3 class="${titleClass} text-sm leading-snug truncate pr-8">${task.title}</h3>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="text-[10px] text-gray-500 font-medium tracking-wide uppercase">${task.category}</span>
                            <div class="size-0.5 rounded-full bg-gray-600"></div>
                            <span class="text-[10px] ${statusColor} font-bold tracking-wide uppercase">${task.status}</span>
                            <div class="ml-auto flex items-center gap-1 text-gray-500">
                                <span class="material-symbols-rounded text-[14px]">event</span>
                                <span class="text-[10px] font-medium">${formatDate(task.dueDate)}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Hover Glow Effect -->
                <div class="absolute inset-0 rounded-2xl bg-gradient-to-r from-primary/0 via-primary/5 to-primary/0 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"></div>
            `;

            // Navigation
            div.addEventListener('click', (e) => {
                if (!e.target.closest('.task-checkbox')) {
                    window.location.href = `todo.html?id=${task.id}`;
                }
            });

            // Checkbox logic
            const box = div.querySelector('.task-checkbox');
            box.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                // Toggle status
                const newStatus = isCompleted ? 'Todo' : 'Completed';
                const updatedTask = { ...task, status: newStatus };
                TaskManager.save(updatedTask);
                // Simple re-render to reflect change
                renderTasks();
            });

            return div;
        }

        function formatDate(dateString) {
            if (!dateString) return '--';
            const date = new Date(dateString);
            const today = new Date();
            const isToday = date.toDateString() === today.toDateString();

            if (isToday) return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            return date.toLocaleDateString([], { month: 'short', day: 'numeric' });
        }

        // Filtering Logic
        const searchInput = document.getElementById('search-input');
        const categoryBtns = document.querySelectorAll('.category-btn');
        let currentCategory = 'All';

        categoryBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                currentCategory = btn.dataset.filter;
                // Visual updates
                categoryBtns.forEach(b => {
                    b.className = "category-btn px-5 py-2.5 rounded-xl glass-card text-gray-400 hover:text-white hover:bg-white/5 text-xs font-bold tracking-wide transition-all border border-transparent hover:border-glass-border";
                });
                btn.className = "category-btn px-5 py-2.5 rounded-xl bg-primary text-white text-xs font-bold tracking-wide shadow-neon transition-all hover:scale-105 active:scale-95";
                renderTasks();
            });
        });

        searchInput.addEventListener('input', renderTasks);

        // Save Logic (Create)
        saveBtn.addEventListener('click', () => {
            const titleInput = document.getElementById('new-task-title');
            const categoryInput = document.getElementById('new-task-category');
            const statusInput = document.getElementById('new-task-status') || { value: 'Todo' }; // Default if removed
            const priorityInput = document.getElementById('new-task-priority');

            const title = titleInput.value;
            if (!title) return;

            const newTask = {
                id: crypto.randomUUID(), // Use UUID
                title: title,
                category: categoryInput.value,
                status: 'Todo',
                priority: priorityInput.value,
                dueDate: new Date().toISOString(),
                description: '',
                estimate: '1h',
                tags: []
            };

            TaskManager.save(newTask);
            closeModal();
            titleInput.value = '';
            renderTasks();
        });

        // Initial render
        renderTasks();

        // Init Profile
        function initProfile() {
            const profile = app.userProfile;
            const greeting = document.getElementById('header-greeting');
            const pic = document.getElementById('header-profile-pic');
            const placeholder = document.getElementById('header-profile-placeholder');

            if (profile) {
                if (profile.name) {
                    greeting.textContent = `${profile.name}'s Workspace`;
                }

                if (profile.photo) {
                    pic.style.backgroundImage = `url("${profile.photo}")`;
                    placeholder.classList.add('hidden');
                } else {
                    pic.style.backgroundImage = 'none';
                    placeholder.classList.remove('hidden');
                }
            }
        }
        initProfile();
    </script>
    </script>
</body>

</html>